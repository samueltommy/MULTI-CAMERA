<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Fused Gallery</title>
    <style>
      .track {
        margin-bottom: 20px;
        border-bottom: 1px solid #ccc;
        padding-bottom: 10px;
      }
      img {
        max-width: 320px;
        max-height: 240px;
        margin-right: 8px;
      }
    </style>
  </head>
  <body>
    <h1>Fused Tracks Gallery</h1>
    <div id="list"></div>
    <script>
      async function load() {
        const r = await fetch("/fused");
        const j = await r.json();
        const div = document.getElementById("list");
        div.innerHTML = "";
        for (const t of j.tracks) {
          const d = document.createElement("div");
          d.className = "track";
          const h = document.createElement("h3");
          h.textContent = `ID ${t.id} (last: ${new Date(
            t.last_seen * 1000
          ).toLocaleString()})`;
          d.appendChild(h);
          if (t.snaps && t.snaps.length) {
            for (const s of t.snaps.slice().reverse()) {
              const container = document.createElement("div");
              const topImg = s.top ? `/snapshots/${s.top}` : null;
              const sideImg = s.side ? `/snapshots/${s.side}` : null;
              if (topImg) {
                const im = document.createElement("img");
                im.src = topImg;
                container.appendChild(im);
              }
              if (sideImg) {
                const im2 = document.createElement("img");
                im2.src = sideImg;
                container.appendChild(im2);
              }
              d.appendChild(container);
            }
          } else {
            const p = document.createElement("p");
            p.textContent = "No snapshots yet";
            d.appendChild(p);
          }
          div.appendChild(d);
        }
      }
      load();
      setInterval(load, 3000);
    </script>
  </body>
</html>
