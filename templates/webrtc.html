<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebRTC Annotated Stream</title>
  </head>
  <body>
    <h3>Annotated WebRTC Stream</h3>
    <video
      id="video"
      autoplay
      playsinline
      controls
      style="width: 800px; height: auto; border: 1px solid #333"
    ></video>
    <div>
      <label>Camera: </label>
      <select id="cam">
        <option value="1">Camera 1</option>
        <option value="2">Camera 2</option>
      </select>
      <button id="start">Start</button>
    </div>

    <script>
      const startBtn = document.getElementById("start");
      const videoEl = document.getElementById("video");

      startBtn.onclick = async () => {
        const cam = document.getElementById("cam").value;
        const pc = new RTCPeerConnection();
        pc.ontrack = (evt) => {
          videoEl.srcObject = evt.streams[0];
        };

        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);

        const resp = await fetch(
          `http://${location.hostname}:8080/offer?cam=${cam}`,
          {
            method: "POST",
            body: JSON.stringify({ sdp: offer.sdp, type: offer.type }),
            headers: { "Content-Type": "application/json" },
          }
        );
        const ans = await resp.json();
        await pc.setRemoteDescription(ans);
      };
    </script>
  </body>
</html>
